# 12月3日　学習内容
## エラー
フロントの画面の「AIレビューを更新する」というボタンを押すと以下ののようなログが出て通信に失敗した。

"OPTIONS /api/review_sessions HTTP/1.1" 400 Bad Request

### 読み方：
OPTIONS：HTTPメソッド、ブラウザが自動で送る自残確認

/api/review_sessions：エンドポイント、実際にPOSTしたいURLと同じ

400Bad Request：FastAPIがリクエストを拒否している

### 現状の整理
まず、OPTIONSとは、POSTなどのリクエストの前にブラウザーなどによって自動で行われることがある
OPTIONSはPreflighted request(試験飛行)で使用されるメソッド
POSTを受け取る側(APIサーバ)で、ヘッダーに対してCORSの設定をすれば解決する

main.py 39
allow_origins=settings.CORS_ORIGINS,
この部分で、指定したオリジン一覧からリクエストは投資定位ということを定義している

#### なぜ今まで出ていなかったのか
バックとフロントを接続していなかったから
今回バックとフロントをつないで始めてやってみた
HTTPリクエストを行る際、一定条件を満たすPOSTリクエストの前には、ブラウザによってOPTIONSリクエスト(preflight)が自動的に送られる。これは「このオリジンから、このHTTPメソッドとヘッダを使って通信してよいか」を事前に確認するためのもの。
FastAPI側では、CORSせってで許可したオリジンのみを受け入れる。しかし、VSCoddのLive Serverは、軌道のたびに使用するポート番号を自動的に変えるためFastAPIが許可していないオリジンから通信が行われ、OPTIONが拒否されていた

### 解決策の過程

fetchリクエストでPOSTリクエストを送るときのパスが絶対パスになっており、そのホスト名が異なっており、別オリジンになっていたため、ブラウザから事前確認(OPTIONS)を行ったと考えられた。そのため、相対パスに変更した
→エラーは治らなかった

### 最終的な解決差kう
もともとCORS_ORIGINとして以下のようなオリジンが許可されていた

CORS_ORIGINS: List[str] = [ 
    "http://localhost:5500", 
    "http://127.0.0.1:5500", 
 ]

 ただし、いま動いているポート番号は8000番だった
 そのため、許可ができておらず、OPTIONSのエラーが起きていた



### 参考記事
【REST API】POSTでリクエストする前のOPTIONSはなに？：
https://qiita.com/Shoma0210/items/4405898205a1822f5826
